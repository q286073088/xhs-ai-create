# 🔥 AI小红书爆款文案生成器 v2.2


 **从"通用模型"到"小红书爆款专家"的革命性升级**
> 智能分析热门笔记，一键生成人味十足的爆款文案

[![Next.js](https://img.shields.io/badge/Next.js-15-black)](https://nextjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5-blue)](https://www.typescriptlang.org/)
[![Tailwind CSS](https://img.shields.io/badge/Tailwind-3-38B2AC)](https://tailwindcss.com/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Version](https://img.shields.io/badge/Version-2.2-green)](https://github.com/your-repo/xhs-ai-writer)
[![小红书](https://img.shields.io/badge/小红书-关注作者-red)](https://www.xiaohongshu.com/user/profile/5e141963000000000100158e)

## ✨ v2.2 核心特性

### 🧠 双重专家系统
- **🔬 分析专家**: 公式化拆解热门笔记，提取可套用的爆款公式
- **🎨 创作专家**: v2.2深度降AIGC策略，11大核心打造人味十足的内容

### 🛡️ 三重安全保障
- **📋 格式稳定性**: 强化Prompt约束 + 后端内容清洗
- **🚨 内容安全性**: 105+敏感词库 + 实时流式过滤
- **✅ 验证完整性**: 多层验证逻辑 + 智能错误恢复

### 🎯 完整内容生态
- **📊 爆款标题**: 基于真实数据的标题公式（情感共鸣型、实用价值型、好奇悬念型）
- **📝 正文内容**: v2.2优化，450-750字精准控制，自然不完美表达
- **🏷️ 智能标签**: 核心词+场景词+人群词+内容类型词的科学组合
- **🎨 配图提示**: 基于封面风格分析的AI绘画提示词
- **💬 首评引导**: SEO优化的评论区引导内容
- **🚀 发布策略**: AI基于内容类型的发布时机建议

### 🚀 v2.2 用户体验全面升级
- **📱 响应式设计**: 完美适配桌面端和移动端，玻璃拟态风格
- **⚡ 流式生成**: 实时显示创作过程，四阶段加载反馈
- **📋 独立复制**: 每个内容模块都有专属复制按钮，支持全文复制
- **🔄 表单持久化**: 切换单次/批量生成时保留用户输入内容
- **⚙️ 动态设置面板**: 左上角设置按钮，实时配置AI模型、Cookie、抓取开关
- **📊 批量生成管理**: 高效的批量生成功能，支持项目添加、删除、状态监控
- **🎯 智能改进功能**: 一键生成改进版本，提升内容质量
- **📜 生成历史记录**: 完整的生成历史管理，支持状态查询和结果查看
- **🎨 UI视觉升级**: 统一紫蓝色主题，现代化渐变设计，流畅动画效果

### 🎨 v2.2 降AIGC核心策略
- **动词短语扩展**: "用"→"开始用"/"去用"，增加自然度
- **口语化辅助词**: "真的"、"居然"、"算是"等生活化表达
- **条件句式转换**: "若...则..."→"要是...那就..."
- **介词系统性替换**: "通过"→"借助/依靠/凭借"
- **字数精准控制**: 450-750字，保持信息密度
- **情绪波动轨迹**: 犹豫→确认、期待→惊喜等真实心理变化
- **细节随机性**: "4天"而非"一周"，"89块"而非"90元"

## 🛠️ 技术栈

### 前端技术
- **框架**: Next.js 15 + React 18 + TypeScript 5
- **样式**: Tailwind CSS 3 + 自定义Shadcn/ui组件
- **状态管理**: React Hooks + 实时流式状态
- **UI增强**: 渐变设计 + 响应式布局 + 动画效果

### 后端技术
- **API**: Next.js API Routes (Serverless Functions)
- **AI集成**: OpenAI兼容接口 + 智能重试机制
- **数据处理**: 流式传输 + 实时内容过滤
- **缓存系统**: 文件缓存 + 智能降级策略

### 安全与稳定性
- **内容安全**: 敏感词过滤 + 实时安全检查
- **格式稳定**: Prompt强化 + 后端内容清洗
- **错误处理**: 结构化错误 + 智能重试机制

## 快速开始

### 1. 环境要求

- Node.js 18+ 
- npm 或 yarn

### 2. 安装依赖

```bash
npm install
```

### 3. 环境变量配置

复制 `.env.local` 文件并填入真实配置：

```env
# 第三方AI服务的接入点URL (通常以 /v1 结尾)
THIRD_PARTY_API_URL="https://your-api-provider.com/v1"

# 第三方AI服务API密钥
THIRD_PARTY_API_KEY="your_api_key_here"

# AI模型名称（支持多模型降级，用逗号分隔）
AI_MODEL_NAME="gemini-2.5-pro,gemini-2.5-flash"

# 缓存功能开关 (true=启用, false=禁用)
ENABLE_CACHE=true

# 数据抓取功能开关 (true=启用完整功能, false=仅AI创作)
ENABLE_SCRAPING=true

# 小红书Cookie（可在设置面板中动态配置，此处为默认值）
XHS_COOKIE="your_xiaohongshu_cookie_here"

# 调试日志开关 (开发环境建议开启)
ENABLE_DEBUG_LOGGING=true
```

**新增配置说明**：
- `ENABLE_SCRAPING`: 控制小红书数据抓取功能，可在前端设置中动态切换
- Cookie支持：现在可以在左上角设置面板中动态配置，无需重启应用

### 4. 启动开发服务器

```bash
npm run dev
```

访问 [http://localhost:3000](http://localhost:3000) 查看应用

## 📖 使用说明

### ⚙️ 第一步：配置设置（可选）
- 点击左上角设置按钮
- 配置AI模型、小红书Cookie等参数
- 开启/关闭数据抓取功能
- 设置会自动保存到浏览器

### 🎯 第二步：选择生成模式
- **单次生成**: 适合快速生成单个主题
- **批量生成**: 适合处理多个相关主题

### ✍️ 第三步：输入主题关键词
- 填写具体的主题关键词（如：`春季敏感肌护肤`、`职场穿搭技巧`、`平价美妆好物`）
- 关键词越具体，分析越精准
- **表单持久化**: 切换模式时内容不会丢失

### 📝 第四步：提供原始素材
使用我们提供的模板，输入详细信息：
```
产品：XX牌新款玻尿酸精华
特点：质地清爽，吸收快，主打深层补水
我的感受：用了一周，感觉皮肤没那么干了，上妆也更服帖
目标人群：20-30岁的年轻女性，混合皮或干皮
价格：199元，性价比很高
```

### 🚀 第五步：AI智能创作
1. **分析阶段**: AI分析该关键词的热门笔记，提取爆款公式（需启用数据抓取）
2. **创作阶段**: 基于公式和您的素材，使用v2.2降AIGC策略生成人味十足的内容

### 📋 第六步：一键复制使用
获得完整的小红书内容包：
- 🎯 **3个爆款标题** - 不同风格，任您选择
- 📝 **正文内容** - v2.2优化，450-750字精准控制
- 🏷️ **热门标签** - 科学组合，提升曝光
- 🎨 **配图提示** - AI绘画提示词，图文并茂
- 💬 **首评引导** - SEO优化的评论区引导内容
- 🚀 **发布策略** - AI基于内容类型的发布时机建议

### 💡 v2.2 核心功能详解

#### 🎯 单次生成模式
- **快速创作**: 适合快速生成单个主题的完整内容包
- **表单模板**: 提供详细的输入模板和示例
- **实时预览**: 四阶段生成进度显示
- **独立复制**: 标题、正文、标签、配图提示词独立复制

#### 📊 批量生成模式
- **项目管理**: 支持添加多个生成项目，独立管理
- **状态监控**: 实时显示每个项目的完成状态（待完善/已完成）
- **批量操作**: 一键添加、删除项目，支持拖拽排序
- **智能提示**: 每个项目独立的状态指示和验证

#### 🎯 智能改进功能
- **一键优化**: 在原始内容基础上生成改进版本
- **对比查看**: 原版和改进版对比展示
- **质量提升**: 使用更高级的提示词策略优化内容
- **灵活控制**: 可选择是否启用改进功能

#### 📜 历史记录管理
- **任务追踪**: 完整记录所有生成任务的状态
- **结果查看**: 支持查看已完成任务的详细结果
- **状态监控**: 实时显示进行中任务的进度
- **数据持久化**: 历史记录长时间保存，支持查询回顾

#### ⚙️ 动态设置面板
- **实时配置**: 无需重启应用即可修改设置
- **Cookie管理**: 动态输入和更新小红书Cookie
- **抓取控制**: 实时开关数据抓取功能
- **模型选择**: 支持多模型配置和优先级设置
- **设置持久化**: 所有设置自动保存到浏览器

#### 🎨 UI/UX 升级
- **玻璃拟态设计**: 现代化的毛玻璃效果和渐变背景
- **统一主题**: 紫蓝色渐变主题，视觉一致性
- **流畅动画**: hover效果、过渡动画、微交互
- **响应式布局**: 完美适配各种屏幕尺寸
- **状态反馈**: Toast提示、加载动画、错误处理

## 部署到Vercel

1. 将代码推送到GitHub仓库
2. 在Vercel中导入项目
3. 配置环境变量（与本地.env.local相同）
4. 一键部署完成

## 项目结构

```
├── app/
│   ├── api/
│   │   ├── analyze-hot-posts/    # 热门分析API
│   │   ├── batch-generate/       # 批量生成API
│   │   ├── generate-combined/    # 组合分析+生成API
│   │   ├── generation-status/    # 生成状态查询API
│   │   └── cron/clean-cache/     # 定时清理缓存
│   ├── generate/                # 生成结果页面
│   ├── globals.css              # 全局样式
│   ├── layout.tsx               # 根布局
│   └── page.tsx                 # 主页面
├── components/
│   ├── GeneratorClient.tsx      # 单次生成组件（支持表单持久化）
│   ├── BatchGenerator.tsx       # 批量生成组件（项目管理）
│   ├── SettingsPanel.tsx        # 动态设置面板组件
│   ├── AuthorCard.tsx           # 作者信息卡片
│   ├── FaqSection.tsx           # FAQ常见问题
│   ├── StructuredData.tsx       # SEO结构化数据
│   └── ui/                      # Shadcn/ui组件库
├── lib/
│   ├── prompts.ts               # v2.2提示词管理（11大降AIGC策略）
│   ├── ai-manager.ts            # AI交互管理（多模型降级）
│   ├── cache-manager.ts         # 缓存管理（三层降级策略）
│   ├── sensitive-words.ts       # 敏感词过滤（105+词库）
│   ├── generation-manager.ts    # 生成任务管理
│   ├── generation-types.ts      # 生成相关类型定义
│   ├── error-handler.ts         # 错误处理
│   ├── constants.ts             # 常量定义
│   ├── types.ts                 # 通用类型定义
│   └── utils.ts                 # 工具函数
├── .env.local                   # 环境变量
└── README.md
```

## 🤖 v2.2 核心技术架构

### 🧠 AI 双重专家系统
**分析专家 + 创作专家** 的二阶段处理流程：

#### 分析专家 (`getAnalysisPrompt`)
- 公式化拆解热门笔记的标题公式
- 提取可套用的爆款模式
- 分析内容结构、标签策略、封面风格
- 返回严格的JSON格式分析报告

#### 创作专家 (`getGenerationPrompt`) - v2.2深度升级
- **11大降AIGC核心策略**：动词短语扩展、口语化辅助词注入、条件句式转换等
- 目标AIGC检测率 < 10%（v2.1目标 < 30%）
- 注入"不完美性"：停顿、修正、重复强调、情绪波动
- 自然细节：随机时间、价格、用量描述

### 🛡️ 多模型智能降级机制
#### 配置方式
```env
# 多模型降级配置（推荐）
AI_MODEL_NAME="gemini-2.5-pro,gemini-2.5-flash,gpt-4o-mini"

# 前端设置面板动态配置
# 支持实时修改模型优先级
```

#### 降级流程
1. **主模型尝试**: `gemini-2.5-pro`（重试2次，指数退避）
2. **智能切换**: 失败后自动切换 `gemini-2.5-flash`
3. **备用保障**: 继续降级到 `gpt-4o-mini`
4. **智能恢复**: 下次请求重新从主模型开始

### 📊 三层降级缓存策略
1. **优先缓存**: 24小时内的有效缓存数据
2. **实时抓取**: 调用小红书API获取最新数据
3. **备用缓存**: 同分类的其他关键词缓存数据

### 🔧 API架构设计
- **组合API**: `/api/generate-combined` - 分析+生成一体化
- **批量API**: `/api/batch-generate` - 批量任务处理
- **状态API**: `/api/generation-status` - 实时状态查询
- **定时任务**: `/api/cron/clean-cache` - 缓存清理

### 🎨 前端状态管理
- **表单持久化**: localStorage存储用户输入
- **设置同步**: 实时配置Cookie和抓取开关
- **任务管理**: 完整的生成任务生命周期管理
- **响应式设计**: 玻璃拟态UI，统一视觉风格

## 缓存与数据抓取功能

### 智能缓存系统
应用内置了智能缓存系统，可以显著提升响应速度并减少对小红书API的请求频率：

- **缓存策略**: 优先使用有效缓存 → 尝试实时抓取 → 降级到同分类备用缓存
- **缓存时效**: 24小时（可在 `lib/cache-manager.ts` 中调整）
- **存储位置**: `data/cache/` 目录（自动创建）
- **分类管理**: 按关键词分类存储，支持跨关键词的备用缓存

### 动态数据抓取控制
v2.2版本新增动态控制功能：

#### 抓取开关配置
```env
# 启用完整功能（缓存+爬取+备用缓存）
ENABLE_SCRAPING=true

# 禁用数据抓取（仅AI创作，不使用缓存）
ENABLE_SCRAPING=false
```

#### 前端动态控制
- **设置面板**: 左上角设置按钮可实时切换抓取功能
- **Cookie配置**: 动态输入小红书Cookie，无需重启应用
- **状态反馈**: 实时显示抓取功能状态和Cookie配置状态

#### 功能场景
- **`ENABLE_SCRAPING=true`**: 生产环境推荐，基于真实热门数据生成
- **`ENABLE_SCRAPING=false`**: 测试环境或Cookie失效时使用，纯AI知识创作

### 缓存开关配置

在 `.env.local` 中设置 `ENABLE_CACHE` 环境变量：

```env
# 启用缓存（默认，推荐）
ENABLE_CACHE=true

# 禁用缓存（每次都重新抓取，响应较慢但数据最新）
ENABLE_CACHE=false
```

### 使用建议

- **开发环境**: 建议启用缓存，提升开发效率
- **生产环境**: 推荐启用完整功能，获得最佳效果
- **Cookie失效**: 动态更新Cookie或切换到禁用抓取模式
- **数据敏感场景**: 可禁用缓存和抓取，使用纯AI创作功能

## 🔧 部署与运维

### Vercel 部署
1. **代码推送**: 将代码推送到GitHub仓库
2. **导入项目**: 在Vercel控制台导入项目
3. **环境变量**: 配置所有必需的环境变量
4. **一键部署**: Vercel自动构建和部署

### 环境变量清单
```env
# 必需配置
THIRD_PARTY_API_URL="https://your-api-provider.com/v1"
THIRD_PARTY_API_KEY="your_api_key"
XHS_COOKIE="your_xiaohongshu_cookie"

# 功能配置
AI_MODEL_NAME="gemini-2.5-pro,gemini-2.5-flash"
ENABLE_CACHE=true
ENABLE_SCRAPING=true
ENABLE_DEBUG_LOGGING=true
```

### 性能优化建议
- **缓存策略**: 生产环境强烈建议启用缓存
- **模型配置**: 使用多模型降级确保高可用性
- **监控指标**: 监控API成功率、缓存命中率、AIGC检测率
- **资源清理**: 定期清理过期缓存文件

## ⚠️ 注意事项

- **API密钥安全**: 请勿将API密钥提交到公共仓库
- **Cookie有效性**: 小红书Cookie需要定期更新，可在设置面板中动态配置
- **模型选择**: 建议使用支持JSON格式输出的AI模型
- **数据隐私**: 缓存文件包含抓取数据，请注意隐私保护
- **浏览器兼容**: 现代浏览器支持localStorage持久化功能

## 🚀 v2.2 版本亮点

### 🎯 用户体验革命性升级
- **零学习成本**: 表单持久化让用户无需重复输入
- **实时配置**: 动态设置面板，配置即时生效
- **无缝切换**: 单次/批量模式间自由切换
- **视觉统一**: 现代化UI设计，专业感十足

### 🔧 技术架构全面优化
- **降AIGC 2.2**: 11大策略，检测率 < 10%
- **智能降级**: 多模型+三层缓存，高可用性
- **模块化设计**: 组件解耦，易于维护扩展
- **类型安全**: 完整的TypeScript类型系统

### 📊 功能生态完善闭环
- **创作→改进**: 智能改进功能，内容质量翻倍
- **批量→历史**: 完整的任务生命周期管理
- **设置→持久化**: 用户体验全程优化
- **数据→安全**: 多重保障，稳定可靠

---

**v2.2版本标志着从小红书文案工具向AI内容创作平台的重大升级！** 🎉

## 🔧 核心技术亮点

### 🧠 双重专家系统架构

#### 分析专家 (`getAnalysisPrompt`)
```typescript
// 公式化拆解热门笔记
{
  "titleFormulas": {
    "suggestedFormulas": ["数字+卖点+人群", "场景+解决方案+情感词"],
    "commonKeywords": ["高频词汇"],
    "avoidWords": ["过时网络用语"]
  },
  "contentStructure": {
    "openingHooks": ["5种开头钩子策略"],
    "bodyTemplate": "痛点→产品→细节→感受→建议",
    "endingHooks": ["5种结尾互动策略"]
  },
  "coverStyleAnalysis": {
    "commonStyles": ["杂志风拼贴", "全身镜穿搭", "左右对比图"],
    "suggestion": "最适合的封面风格建议"
  }
}
```

#### 创作专家 (`getGenerationPrompt`)
- **人设注入**: 从"AI助手"转变为"和闺蜜分享好物的朋友"
- **AI味清除**: 禁用"首先"、"其次"、"yyds"、"绝绝子"等机械化表达
- **真情实感**: 使用"天啊！"、"我挖到宝了！"、"真的栓Q！"等生活化感叹
- **细节升级**: 从"很好看"到"阳光下波光粼粼的感觉，绝了"

### 🛡️ 三重安全保障系统

#### 1. 格式稳定性
```typescript
// 后端内容清洗
let contentStarted = false;
const startMarker = "## 1. 爆款标题创作";
// 自动过滤AI前置解释文字
```

#### 2. 内容安全性
```typescript
// 105+敏感词库 + 实时过滤
const sensitiveWords = [
  "最", "第一", "治疗", "疗效", "秒杀", "100%有效"
  // ... 8大类敏感词汇
];
// 智能替换：'最' → '很', '治疗' → '改善'
```

#### 3. 验证完整性
```typescript
// 多层验证逻辑
validateTitleFormulas(titleFormulas, errors);
validateContentStructure(contentStructure, errors);
validateTagStrategy(tagStrategy, errors);
```

### ⚡ 智能内容解析引擎
- **四部分解析**: 自动提取标题、正文、标签、AI绘画提示词
- **正则表达式匹配**: 支持多种格式变体的智能识别
- **实时流式解析**: React useEffect实时监听并分割内容
- **备用降级策略**: 正则失败时自动使用固定标记匹配

### 🎨 用户体验优化
- **多阶段加载**: `🔍 正在分析热门笔记...` → `✅ 分析完成！正在生成文案...`
- **独立复制功能**: 每个内容模块都有专属复制按钮
- **渐变视觉设计**: 粉红到红色的现代化渐变效果
- **响应式布局**: 完美适配桌面端和移动端

---
### 感谢

https://github.com/EBOLABOY/xhs-ai-writer#  提供的基础版本。

## 许可证

MIT License
